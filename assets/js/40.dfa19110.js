(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{511:function(t,e,v){"use strict";v.r(e);var _=v(56),i=Object(_.a)({},(function(){var t=this,e=t.$createElement,v=t._self._c||e;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[v("h2",{attrs:{id:"浏览器缓存"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#浏览器缓存"}},[t._v("#")]),t._v(" 浏览器缓存")]),t._v(" "),v("blockquote",[v("p",[t._v("浏览器缓存是指浏览器对用户请求过的资源进行存储，当访问者再次访问某个页面的时候，浏览器会根据设定的缓存策略去判断，是直接从存储中拿资源，还是发送请求给服务器重新获取资源。"),v("br"),t._v("\n浏览器的缓存策略包括"),v("b",[t._v("强缓存")]),t._v("和"),v("b",[t._v("协商缓存")])])]),t._v(" "),v("p",[t._v("1️⃣ "),v("b",[t._v("强缓存")]),t._v(": 当请求资源时，如果是之前请求过的资源且命中强缓存，直接从浏览器缓存中获取(不管资源实际上是否过期), 强缓存是利用 "),v("code",[t._v("http")]),t._v(" 头中的"),v("span",{staticStyle:{color:"red"}},[t._v("Expires")]),t._v("(http1.0)和"),v("span",{staticStyle:{color:"red"}},[t._v("Cache-Control")]),t._v("（http1.1)两个字段来控制")]),t._v(" "),v("ul",[v("li",[t._v("Expires"),t._v("：该值是一个 GMT 时间格式个字符串，可以设定浏览器缓存的过期时间。\n"),v("ul",[v("li",[t._v("当第一次请求时，"),v("code",[t._v("resonse header")]),t._v("会返回"),v("code",[t._v("Expires")]),t._v("属性")]),t._v(" "),v("li",[t._v("当再次请求的时间在这个时间之前则命中缓存，即使用浏览器缓存的资源，否则会重新发送请求给服务端重新获取资源")])])]),t._v(" "),v("li",[v("code",[t._v("Cache-Control")]),t._v(" "),v("ul",[v("li",[t._v("private：仅浏览器可以缓存（默认值）；")]),t._v(" "),v("li",[t._v("public：浏览器和代理服务器都可以缓存；")]),t._v(" "),v("li",[t._v("max-age=xxx：过期时间单位秒；")]),t._v(" "),v("li",[t._v("no-cache：不进行强缓存；")]),t._v(" "),v("li",[t._v("no-store：不强缓存，也不协商缓存）")])])]),t._v(" "),v("li",[t._v("补充： "),v("code",[t._v("Expire")]),t._v("和"),v("code",[t._v("Cache-Control")]),t._v("用回车、后退、F5 刷新会跳过本地缓存，每次都会从服务器中获数据。")])]),t._v(" "),v("p",[t._v("2️⃣ "),v("b",[t._v("协商缓存")]),t._v(": 由服务器判断文件是否过期，是否需要重新返回新资源给浏览器")]),t._v(" "),v("ul",[v("li",[v("p",[v("b",[t._v("Last-Modify 和 if-modified-since")])]),t._v(" "),v("ul",[v("li",[v("b",[t._v("Last-Modified")]),t._v(": 是 "),v("code",[t._v("resonse header")]),t._v(" 的属性，表示为资源的最后更新时间")]),t._v(" "),v("li",[v("b",[t._v("if-modified-since")]),t._v(" 是 "),v("code",[t._v("request body")]),t._v(" 的属性")]),t._v(" "),v("li",[t._v("第一次请求时，服务器返回的 header 中会加上"),v("b",[t._v("Last-Modified")])]),t._v(" "),v("li",[t._v("第二次请求时，"),v("code",[t._v("request")]),t._v("的头部会带上"),v("b",[t._v("if-modified-since")]),t._v("，该值为缓存之前返回的 Last-Modify。服务器收到"),v("b",[t._v("if-modified-since")]),t._v("后，根据资源的最后修改时间判断是否命中缓存")])])]),t._v(" "),v("li",[v("p",[v("b",[t._v("Etag 和 If-None-Match")]),t._v("：")]),t._v(" "),v("ul",[v("li",[v("b",[t._v("Etag")]),t._v(" 是 "),v("code",[t._v("resonse header")]),t._v(" 的属性，是资源的唯一识别码，只要服务器的文件有修改，这个 "),v("code",[t._v("Etag")]),t._v(" 就会发生变化")]),t._v(" "),v("li",[v("b",[t._v("if-modified-since")]),t._v(" 是 "),v("code",[t._v("request body")]),t._v(" 的属性")]),t._v(" "),v("li",[t._v("第一次请求时，"),v("code",[t._v("resonse header")]),t._v(" 会返回 "),v("b",[t._v("Etag")]),t._v("，同时 "),v("code",[t._v("request body")]),t._v(" 是没有"),v("b",[v("code",[t._v("if-modified-since")])]),t._v(" 的。状态码为"),v("span",{staticStyle:{color:"red"}},[t._v("200")])]),t._v(" "),v("li",[t._v("第二次请求时，"),v("code",[t._v("request body")]),t._v(" 会携带上 "),v("b",[t._v("if-modified-since")]),t._v("(和 "),v("code",[t._v("Etag")]),t._v(" 是一样的值)。服务器会根据这个去判断资源是否过期，如果资源"),v("b",[t._v("没过期")]),t._v("，"),v("code",[t._v("resonse header")]),t._v(" 会返回之前的 Etag，同时状态码为"),v("span",{staticStyle:{color:"red"}},[t._v("304(Not Modified)")])]),t._v(" "),v("li",[t._v("第二次请求时，如果资源"),v("b",[t._v("已过期")]),t._v("，"),v("code",[t._v("resonse header")]),t._v(" 会返回新的 "),v("code",[t._v("Etag")]),t._v("，状态码为"),v("span",{staticStyle:{color:"red"}},[t._v("200")])])])])]),t._v(" "),v("blockquote",[v("p",[t._v("强缓存是浏览器直接决定是否使用缓存，协商缓存是服务器通过"),v("b",[t._v("if-modified-since")]),t._v("判断是否使用缓存")])]),t._v(" "),v("p",[t._v("为什么有了"),v("b",[t._v("Last-Modify 和 if-modified-since")]),t._v("还要"),v("b",[t._v("Etag 和 If-None-Match")]),t._v("呢？")]),t._v(" "),v("ul",[v("li",[t._v("有些文件可能发生周期性改变，但是文件内容并没有改变，这种情况下，重新获取资源是浪费的")]),t._v(" "),v("li",[t._v("有些文件的修改非常频繁，比如在 1s 内发生了 N 次修改，而使用"),v("code",[t._v("Last-Modified")]),t._v("时，"),v("code",[t._v("If-Modified-Since")]),t._v("能检查到的粒度是 s 级的, 就无法检测到文件实际上已经发生了改变需要重新获取资源")]),t._v(" "),v("li",[t._v("当"),v("code",[t._v("Last-Modified")]),t._v("与"),v("code",[t._v("ETag")]),t._v("一起使用时，服务器会优先验证"),v("code",[t._v("ETag")]),t._v(" ，一致的情况下，才会继续比对 Last-Modified，最后才决定是否返回 304。")])]),t._v(" "),v("h3",{attrs:{id:"刷新操作对缓存的影响"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#刷新操作对缓存的影响"}},[t._v("#")]),t._v(" 刷新操作对缓存的影响")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",{staticStyle:{"text-align":"left"}},[t._v("操作")]),t._v(" "),v("th",{staticStyle:{"text-align":"center"}},[t._v("强缓存")]),t._v(" "),v("th",{staticStyle:{"text-align":"center"}},[t._v("协商缓存")])])]),t._v(" "),v("tbody",[v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("正常操作：地址栏输入 URL，跳转链接，前进或者后退")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("√")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("√")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("手动刷新："),v("code",[t._v("F5")]),t._v(", 浏览器刷新按钮，右键刷新")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("X")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("√")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("强制刷新： "),v("code",[t._v("ctrl + F5")])]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("X")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("X")])])])]),t._v(" "),v("h3",{attrs:{id:"不安全-https-对协商缓存的影响"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#不安全-https-对协商缓存的影响"}},[t._v("#")]),t._v(" 不安全 https 对协商缓存的影响")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",{staticStyle:{"text-align":"left"}},[t._v("操作")]),t._v(" "),v("th",{staticStyle:{"text-align":"center"}},[t._v("谷歌")]),t._v(" "),v("th",{staticStyle:{"text-align":"center"}},[t._v("火狐")])])]),t._v(" "),v("tbody",[v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("正常操作：地址栏输入 URL，跳转链接，前进或者后退")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("全部不缓存")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("√")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("手动刷新："),v("code",[t._v("F5")]),t._v(", 浏览器刷新按钮，右键刷新")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("部分文件不缓存")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("√")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("强制刷新： "),v("code",[t._v("ctrl + F5")])]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("X")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("X")])])])]),t._v(" "),v("blockquote",[v("p",[t._v("在谷歌浏览器中，当进行手动刷新时，只会缓存带有"),v("code",[t._v("preload")]),t._v("属性的文件")])])])}),[],!1,null,null,null);e.default=i.exports}}]);